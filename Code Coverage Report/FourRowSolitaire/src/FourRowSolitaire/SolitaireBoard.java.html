<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>SolitaireBoard.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">Merged (Dec 3, 2017 1:29:15 AM)</a> &gt; <a href="../../index.html" class="el_group">FourRowSolitaire</a> &gt; <a href="../index.html" class="el_bundle">src</a> &gt; <a href="index.source.html" class="el_package">FourRowSolitaire</a> &gt; <span class="el_source">SolitaireBoard.java</span></div><h1>SolitaireBoard.java</h1><pre class="source lang-java linenums">/*
    This file is a part of Four Row Solitaire

    Copyright (C) 2010 by Matt Stephen

    Four Row Solitaire is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Four Row Solitaire is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with FourRowSolitaire.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */

package FourRowSolitaire;

import java.awt.*;
import java.awt.event.*;
import java.io.*;
import java.util.LinkedList;
import javax.swing.*;
import javax.swing.event.MouseInputAdapter;

/**
 * Class: SolitaireBoard
 *
 * Description: The SolitaireBoard class manages the entire playing field.
 *
 * @author Matt Stephen
 */
public class SolitaireBoard extends JFrame {
	public static final int GAME_WON = 0;
	public static final int GAME_LOST = 1;
	public static final int RESET_STATS = 2;
	public static final int DO_NOTHING = 3;
	public static final int GAME_SAVED = 4;

<span class="fc" id="L43">	private int drawCount = 1; // can be 1 or 3</span>

	// To store new option selection for next new game, otherwise the count would
	// be changed at next click of the deck (in the middle of the game)
<span class="fc" id="L47">	private int newDrawCount = drawCount;</span>

<span class="fc" id="L49">	private int backgroundNumber = 2;</span>
<span class="fc" id="L50">	private int deckNumber = 3;</span>
<span class="fc" id="L51">	private Deck deck = new Deck(deckNumber); // Create default-backed deck (auto shuffles)</span>

	// The four columns for the main playing field
<span class="fc" id="L54">	private Column[] columns = new Column[4];</span>

	// The deal and discard piles
<span class="fc" id="L57">	private DiscardPile discardPile = new DiscardPile(drawCount);</span>
<span class="fc" id="L58">	private DealDeck dealDeck = new DealDeck(discardPile, drawCount);</span>

	// The four ace piles (to stack Ace - King of a single suit)
<span class="fc" id="L61">	private AcePile[] acePiles = new AcePile[4];</span>

	// The four top individual cells
<span class="fc" id="L64">	private SingleCell[] cells = new SingleCell[4];</span>

	private SolitairePanel mainPanel;

<span class="fc" id="L68">	private MyMouseListener ml = new MyMouseListener();</span>
<span class="fc" id="L69">	public MyWindowListener wl = new MyWindowListener();</span>

<span class="fc" id="L71">	private Timer timer = new Timer(1000, new TimerListener());</span>
<span class="fc" id="L72">	private JPanel statusBar = new JPanel(new FlowLayout(FlowLayout.CENTER));</span>
<span class="fc" id="L73">	private JLabel timerLabel = new JLabel(&quot;Time: OFF&quot;);</span>
<span class="fc" id="L74">	private int timerCount = 0;</span>
<span class="fc" id="L75">	private int timerToRunNextGame = 0;</span>
<span class="fc" id="L76">	private boolean timerToRun = false;</span>

<span class="fc" id="L78">	private int winAnimationStatus = 0;</span>
<span class="fc" id="L79">	private int winSoundsStatus = 0;</span>

<span class="fc" id="L81">	private int difficulty = 2; // 1 = easy, 2 = medium, 3 = hard</span>
<span class="fc" id="L82">	private int newDifficulty = difficulty;</span>

	// sourcelist changed to protected, if we select new game in the fourrowsolitaire.java
	// we need to see if we've made any moves to decide if it counts as a loss
<span class="fc" id="L86">	protected LinkedList&lt;CardStack&gt; sourceList = new LinkedList&lt;CardStack&gt;();</span>
<span class="fc" id="L87">	private LinkedList&lt;CardStack&gt; destinationList = new LinkedList&lt;CardStack&gt;();</span>
<span class="fc" id="L88">	private LinkedList&lt;Integer&gt; numCards = new LinkedList&lt;Integer&gt;();</span>
<span class="fc" id="L89">	private LinkedList&lt;Integer&gt; numCardsInDiscardView = new LinkedList&lt;Integer&gt;();</span>

<span class="fc" id="L91">	public SolitaireBoard() {</span>
<span class="fc" id="L92">		setTitle(&quot;Four Row Solitaire&quot;);</span>
<span class="fc" id="L93">		setSize(800, 700);</span>
<span class="fc" id="L94">		setLocationRelativeTo(null);</span>
<span class="fc" id="L95">		setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span>
<span class="fc" id="L96">		setResizable(false);</span>
<span class="fc" id="L97">		setIconImage(new ImageIcon(getClass().getResource(&quot;images/logo.png&quot;)).getImage());</span>

<span class="fc" id="L99">		setVisible(true);</span>

<span class="fc" id="L101">		addWindowListener(wl);</span>
<span class="fc" id="L102">	}</span>

	public void createBoard(LinkedList&lt;Integer&gt; cards) {
<span class="fc" id="L105">		mainPanel = new SolitairePanel();</span>
<span class="fc" id="L106">		mainPanel.setLayout(new SolitaireLayout());</span>

<span class="fc" id="L108">		deck = new Deck(deckNumber);</span>
<span class="fc" id="L109">		mainPanel.changeBackground(backgroundNumber);</span>

<span class="fc bfc" id="L111" title="All 2 branches covered.">		for (int i = 0; i &lt; 4; i++) {</span>
<span class="fc" id="L112">			columns[i] = new Column();</span>
<span class="fc" id="L113">			columns[i].addMouseListener(ml);</span>
			// columns[i].addMouseMotionListener(ml);
		}

<span class="fc" id="L117">		mainPanel.add(columns[0], SolitaireLayout.COLUMN_ONE);</span>
<span class="fc" id="L118">		mainPanel.add(columns[1], SolitaireLayout.COLUMN_TWO);</span>
<span class="fc" id="L119">		mainPanel.add(columns[2], SolitaireLayout.COLUMN_THREE);</span>
<span class="fc" id="L120">		mainPanel.add(columns[3], SolitaireLayout.COLUMN_FOUR);</span>

<span class="fc bfc" id="L122" title="All 2 branches covered.">		for (int i = 0; i &lt; 4; i++) {</span>
<span class="fc" id="L123">			cells[i] = new SingleCell();</span>
<span class="fc" id="L124">			cells[i].addMouseListener(ml);</span>
			// cells[i].addMouseMotionListener(ml);
		}

<span class="fc" id="L128">		mainPanel.add(cells[0], SolitaireLayout.CELL_ONE);</span>
<span class="fc" id="L129">		mainPanel.add(cells[1], SolitaireLayout.CELL_TWO);</span>
<span class="fc" id="L130">		mainPanel.add(cells[2], SolitaireLayout.CELL_THREE);</span>
<span class="fc" id="L131">		mainPanel.add(cells[3], SolitaireLayout.CELL_FOUR);</span>

<span class="fc" id="L133">		dealDeck.addMouseListener(ml);</span>
		// dealDeck.addMouseMotionListener(ml);
<span class="fc" id="L135">		discardPile.addMouseListener(ml);</span>
		// discardPile.addMouseMotionListener(ml);

<span class="fc" id="L138">		mainPanel.add(dealDeck, SolitaireLayout.DECK);</span>
<span class="fc" id="L139">		mainPanel.add(discardPile, SolitaireLayout.DISCARD_PILE);</span>

<span class="fc bfc" id="L141" title="All 2 branches covered.">		for (int i = 0; i &lt; 4; i++) {</span>
<span class="pc bpc" id="L142" title="1 of 5 branches missed.">			switch (i) {</span>
			case 0:
<span class="fc" id="L144">				acePiles[i] = new AcePile(Card.SPADES_SUIT);</span>
<span class="fc" id="L145">				break;</span>
			case 1:
<span class="fc" id="L147">				acePiles[i] = new AcePile(Card.CLUBS_SUIT);</span>
<span class="fc" id="L148">				break;</span>
			case 2:
<span class="fc" id="L150">				acePiles[i] = new AcePile(Card.DIAMONDS_SUIT);</span>
<span class="fc" id="L151">				break;</span>
			case 3:
<span class="fc" id="L153">				acePiles[i] = new AcePile(Card.HEARTS_SUIT);</span>
<span class="fc" id="L154">				break;</span>

			default:
				;
				break;
			}

<span class="fc" id="L161">			acePiles[i].addMouseListener(ml);</span>
			// acePiles[i].addMouseMotionListener(ml);
		}

<span class="fc" id="L165">		mainPanel.add(acePiles[0], SolitaireLayout.SPADES_ACE_PILE);</span>
<span class="fc" id="L166">		mainPanel.add(acePiles[1], SolitaireLayout.CLUBS_ACE_PILE);</span>
<span class="fc" id="L167">		mainPanel.add(acePiles[2], SolitaireLayout.DIAMONDS_ACE_PILE);</span>
<span class="fc" id="L168">		mainPanel.add(acePiles[3], SolitaireLayout.HEARTS_ACE_PILE);</span>

<span class="fc" id="L170">		statusBar.add(timerLabel);</span>

<span class="fc" id="L172">		JPanel p1 = new JPanel(new BorderLayout());</span>
<span class="fc" id="L173">		p1.add(mainPanel, BorderLayout.CENTER);</span>
<span class="fc" id="L174">		p1.add(statusBar, BorderLayout.SOUTH);</span>
<span class="fc" id="L175">		add(p1);</span>

<span class="pc bpc" id="L177" title="1 of 2 branches missed.">		if (cards != null) {</span>
<span class="fc" id="L178">			dealOutCustomBoard(cards);</span>
<span class="fc" id="L179">		} else {</span>
<span class="nc" id="L180">			dealOutBoard();</span>
		}
<span class="fc" id="L182">	}</span>

	private void dealOutBoard() {
<span class="fc" id="L185">		LinkedList&lt;Card&gt; cards = deck.getDeck();</span>

<span class="fc bfc" id="L187" title="All 2 branches covered.">		for (int i = 0; i &lt; 6; i++) {</span>
<span class="fc bfc" id="L188" title="All 2 branches covered.">			for (int j = 0; j &lt; 4; j++) {</span>
<span class="fc" id="L189">				Card card = cards.getLast();</span>
<span class="fc" id="L190">				cards.removeLast();</span>

<span class="fc bfc" id="L192" title="All 2 branches covered.">				if (i &lt; 5) {</span>
<span class="fc" id="L193">					columns[j].addCard(card);</span>
<span class="fc" id="L194">				} else {</span>
<span class="fc" id="L195">					cells[j].addCard(card);</span>
				}
			}
		}

<span class="fc bfc" id="L200" title="All 2 branches covered.">		if (newDrawCount != drawCount) {</span>
<span class="fc" id="L201">			dealDeck.setDrawCount(newDrawCount);</span>
<span class="fc" id="L202">			drawCount = newDrawCount;</span>
		}

<span class="fc bfc" id="L205" title="All 2 branches covered.">		if (newDifficulty != difficulty) {</span>
<span class="fc" id="L206">			dealDeck.setDifficulty(newDifficulty);</span>
<span class="fc" id="L207">			difficulty = newDifficulty;</span>
<span class="fc" id="L208">		} else {</span>
<span class="fc" id="L209">			dealDeck.setDifficulty(difficulty);</span>
		}

<span class="fc" id="L212">		dealDeck.setDeck(cards);</span>

<span class="fc" id="L214">		timerCount = 0;</span>

<span class="fc bfc" id="L216" title="All 2 branches covered.">		if (timerToRunNextGame == 1) {</span>
<span class="fc" id="L217">			timer.stop();</span>
<span class="fc" id="L218">			timerLabel.setText(&quot;Timer: 0&quot;);</span>
<span class="fc" id="L219">			timerToRun = true;</span>
<span class="fc" id="L220">		} else {</span>
<span class="fc" id="L221">			timer.stop();</span>
<span class="fc" id="L222">			timerLabel.setText(&quot;Time: OFF&quot;);</span>

<span class="fc" id="L224">			timerToRun = false;</span>
		}

<span class="fc" id="L227">		mainPanel.revalidate();</span>
<span class="fc" id="L228">	}</span>

	private void dealOutCustomBoard(LinkedList&lt;Integer&gt; numbers) {
<span class="fc" id="L231">		LinkedList&lt;Card&gt; cards = deck.getDeck(numbers);</span>

<span class="fc" id="L233">		int pileNumber = 0;</span>
<span class="fc" id="L234">		int cardNumber = -1;</span>

<span class="fc bfc" id="L236" title="All 2 branches covered.">		for (int i = 0; i &lt; numbers.size(); i++) {</span>
<span class="fc bfc" id="L237" title="All 2 branches covered.">			if (numbers.get(i) &gt; 0) {</span>
<span class="fc" id="L238">				cardNumber++;</span>
<span class="fc" id="L239">			} else {</span>
<span class="fc" id="L240">				pileNumber++;</span>
<span class="fc" id="L241">				continue;</span>
			}

<span class="fc bfc" id="L244" title="All 2 branches covered.">			if (pileNumber == 0) {</span>
<span class="fc" id="L245">				cells[0].addCard(cards.get(cardNumber));</span>
<span class="fc bfc" id="L246" title="All 2 branches covered.">			} else if (pileNumber == 1) {</span>
<span class="fc" id="L247">				cells[1].addCard(cards.get(cardNumber));</span>
<span class="fc bfc" id="L248" title="All 2 branches covered.">			} else if (pileNumber == 2) {</span>
<span class="fc" id="L249">				cells[2].addCard(cards.get(cardNumber));</span>
<span class="fc bfc" id="L250" title="All 2 branches covered.">			} else if (pileNumber == 3) {</span>
<span class="fc" id="L251">				cells[3].addCard(cards.get(cardNumber));</span>
<span class="fc" id="L252">			}</span>

<span class="fc bfc" id="L254" title="All 2 branches covered.">			else if (pileNumber == 4) {</span>
<span class="fc" id="L255">				columns[0].addCard(cards.get(cardNumber));</span>
<span class="fc bfc" id="L256" title="All 2 branches covered.">			} else if (pileNumber == 5) {</span>
<span class="fc" id="L257">				columns[1].addCard(cards.get(cardNumber));</span>
<span class="fc bfc" id="L258" title="All 2 branches covered.">			} else if (pileNumber == 6) {</span>
<span class="fc" id="L259">				columns[2].addCard(cards.get(cardNumber));</span>
<span class="fc bfc" id="L260" title="All 2 branches covered.">			} else if (pileNumber == 7) {</span>
<span class="fc" id="L261">				columns[3].addCard(cards.get(cardNumber));</span>
<span class="fc" id="L262">			}</span>

<span class="pc bpc" id="L264" title="1 of 2 branches missed.">			else if (pileNumber == 8) {</span>
<span class="nc" id="L265">				acePiles[0].addCard(cards.get(cardNumber));</span>
<span class="pc bpc" id="L266" title="1 of 2 branches missed.">			} else if (pileNumber == 9) {</span>
<span class="nc" id="L267">				acePiles[1].addCard(cards.get(cardNumber));</span>
<span class="pc bpc" id="L268" title="1 of 2 branches missed.">			} else if (pileNumber == 10) {</span>
<span class="nc" id="L269">				acePiles[2].addCard(cards.get(cardNumber));</span>
<span class="pc bpc" id="L270" title="1 of 2 branches missed.">			} else if (pileNumber == 11) {</span>
<span class="nc" id="L271">				acePiles[3].addCard(cards.get(cardNumber));</span>
<span class="nc" id="L272">			}</span>

<span class="pc bpc" id="L274" title="1 of 2 branches missed.">			else if (pileNumber == 12) {</span>
<span class="fc" id="L275">				Card card = cards.get(cardNumber);</span>
<span class="fc" id="L276">				card.setFaceDown();</span>
<span class="fc" id="L277">				dealDeck.addCard(card);</span>
<span class="pc bnc" id="L278" title="All 2 branches missed.">			} else if (pileNumber == 13) {</span>
<span class="nc" id="L279">				discardPile.push(cards.get(cardNumber));</span>
			}
		}

<span class="fc" id="L283">		dealDeck.setDrawCount(drawCount);</span>
<span class="fc" id="L284">		dealDeck.setDifficulty(difficulty);</span>
<span class="fc" id="L285">		timerCount = 0;</span>

<span class="fc bfc" id="L287" title="All 2 branches covered.">		if (timerToRunNextGame == 1) {</span>
<span class="fc" id="L288">			timer.stop();</span>
<span class="fc" id="L289">			timerLabel.setText(&quot;Time: 0&quot;);</span>

<span class="fc" id="L291">			timerToRun = true;</span>
<span class="fc" id="L292">		} else {</span>
<span class="fc" id="L293">			timer.stop();</span>
<span class="fc" id="L294">			timerLabel.setText(&quot;Time: OFF&quot;);</span>

<span class="fc" id="L296">			timerToRun = false;</span>

		}

<span class="fc" id="L300">		mainPanel.revalidate();</span>
<span class="fc" id="L301">	}</span>

	private void clearBoard() {
<span class="fc bfc" id="L304" title="All 2 branches covered.">		for (int i = 0; i &lt; 4; i++) {</span>
<span class="fc bfc" id="L305" title="All 2 branches covered.">			while (!columns[i].isEmpty()) {</span>
<span class="fc" id="L306">				columns[i].pop();</span>
			}

<span class="fc" id="L309">			columns[i].repaint();</span>
		}

<span class="fc bfc" id="L312" title="All 2 branches covered.">		for (int i = 0; i &lt; 4; i++) {</span>
<span class="fc bfc" id="L313" title="All 2 branches covered.">			while (!cells[i].isEmpty()) {</span>
<span class="fc" id="L314">				cells[i].pop();</span>
			}

<span class="fc" id="L317">			cells[i].repaint();</span>
		}

<span class="fc bfc" id="L320" title="All 2 branches covered.">		for (int i = 0; i &lt; 4; i++) {</span>
<span class="fc bfc" id="L321" title="All 2 branches covered.">			while (!acePiles[i].isEmpty()) {</span>
<span class="fc" id="L322">				acePiles[i].pop();</span>
			}

<span class="fc" id="L325">			acePiles[i].repaint();</span>
		}

<span class="fc bfc" id="L328" title="All 2 branches covered.">		while (!dealDeck.isEmpty()) {</span>
<span class="fc" id="L329">			dealDeck.pop();</span>
		}

<span class="fc" id="L332">		dealDeck.repaint();</span>

<span class="fc bfc" id="L334" title="All 2 branches covered.">		while (!discardPile.isEmpty()) {</span>
<span class="fc" id="L335">			discardPile.pop();</span>
		}

<span class="fc" id="L338">		discardPile.repaint();</span>
<span class="fc" id="L339">	}</span>

	public void newGame(int winOrLoss) {
		// If the game was won, the win was already reported
<span class="pc bpc" id="L343" title="1 of 4 branches missed.">		if (winOrLoss != GAME_WON &amp;&amp; winOrLoss != DO_NOTHING) {</span>
<span class="fc" id="L344">			int check = JOptionPane.showConfirmDialog(this,</span>
<span class="fc" id="L345">					&quot;Quitting the current game will result in a loss.\n&quot; + &quot;Do you wish to continue?&quot;, &quot;Continue?&quot;,</span>
<span class="fc" id="L346">					JOptionPane.YES_NO_OPTION);</span>

<span class="fc bfc" id="L348" title="All 2 branches covered.">			if (check == JOptionPane.YES_OPTION) {</span>
<span class="fc" id="L349">				recordGame(GAME_LOST);</span>
<span class="fc" id="L350">			} else {</span>
				// If player wants to continue game
<span class="fc" id="L352">				return;</span>
			}
		}

<span class="fc" id="L356">		deck = new Deck(deckNumber);</span>

<span class="fc" id="L358">		clearBoard(); // Remove cards from ace piles</span>
<span class="fc" id="L359">		dealDeck.reset(); // Set numTimesThroughDeck back to 1</span>
<span class="fc" id="L360">		dealOutBoard();</span>

<span class="fc" id="L362">		sourceList.clear();</span>
<span class="fc" id="L363">		destinationList.clear();</span>
<span class="fc" id="L364">		numCards.clear();</span>
<span class="fc" id="L365">		numCardsInDiscardView.clear();</span>
<span class="fc" id="L366">	}</span>

	public void resetStats() {
<span class="fc" id="L369">		recordGame(RESET_STATS);</span>
<span class="fc" id="L370">	}</span>

	public void saveOptions() {
<span class="fc" id="L373">		recordGame(DO_NOTHING);</span>
<span class="fc" id="L374">	}</span>

	private void recordGame(int winOrLoss) {
<span class="fc" id="L377">		int count = 0, temp = 0;</span>
<span class="fc" id="L378">		int gamesPlayed1e = 0, gamesWon1e = 0, winStreak1e = 0, lossStreak1e = 0, currentStreak1e = 0;</span>
<span class="fc" id="L379">		int gamesPlayed1m = 0, gamesWon1m = 0, winStreak1m = 0, lossStreak1m = 0, currentStreak1m = 0;</span>
<span class="fc" id="L380">		int gamesPlayed1h = 0, gamesWon1h = 0, winStreak1h = 0, lossStreak1h = 0, currentStreak1h = 0;</span>
<span class="fc" id="L381">		int gamesPlayed3e = 0, gamesWon3e = 0, winStreak3e = 0, lossStreak3e = 0, currentStreak3e = 0;</span>
<span class="fc" id="L382">		int gamesPlayed3m = 0, gamesWon3m = 0, winStreak3m = 0, lossStreak3m = 0, currentStreak3m = 0;</span>
<span class="fc" id="L383">		int gamesPlayed3h = 0, gamesWon3h = 0, winStreak3h = 0, lossStreak3h = 0, currentStreak3h = 0;</span>

<span class="fc" id="L385">		String fileLocation = System.getProperty(&quot;user.home&quot;) + System.getProperty(&quot;file.separator&quot;);</span>
<span class="fc" id="L386">		File file = new File(fileLocation + &quot;frs-statistics.dat&quot;);</span>

		try {
<span class="fc" id="L389">			file.createNewFile();</span>
<span class="pc" id="L390">		} catch (Exception ex) {</span>
<span class="nc" id="L391">			System.out.println(ex);</span>
		}

		try {
<span class="fc" id="L395">			DataInputStream input = new DataInputStream(new FileInputStream(file));</span>

<span class="pc bpc" id="L397" title="1 of 2 branches missed.">			if (input.available() &gt; 0) {</span>
<span class="fc" id="L398">				temp = input.readInt();</span>
<span class="fc" id="L399">				count++;</span>
			}

<span class="pc bpc" id="L402" title="1 of 2 branches missed.">			if (temp != -1) {</span>
<span class="nc" id="L403">				gamesPlayed1m = temp;</span>

<span class="nc bnc" id="L405" title="All 4 branches missed.">				while ((input.available() &gt; 0) &amp;&amp; count &lt; 5) {</span>
<span class="nc" id="L406">					temp = input.readInt();</span>
<span class="nc bnc" id="L407" title="All 5 branches missed.">					switch (count) {</span>
					// case 0 is the format checker
					case 1:
<span class="nc" id="L410">						gamesWon1m = temp;</span>
<span class="nc" id="L411">						break;</span>
					case 2:
<span class="nc" id="L413">						winStreak1m = temp;</span>
<span class="nc" id="L414">						break;</span>
					case 3:
<span class="nc" id="L416">						lossStreak1m = temp;</span>
<span class="nc" id="L417">						break;</span>
					case 4:
<span class="nc" id="L419">						currentStreak1m = temp;</span>
<span class="nc" id="L420">						break;</span>

					default:
						;
						break;
					}

<span class="nc" id="L427">					count++;</span>
				}
<span class="nc" id="L429">			} else {</span>
<span class="pc bpc" id="L430" title="1 of 4 branches missed.">				while ((input.available() &gt; 0) &amp;&amp; count &lt; 31) {</span>
<span class="fc" id="L431">					temp = input.readInt();</span>
<span class="pc bpc" id="L432" title="1 of 31 branches missed.">					switch (count) {</span>
					// case 0 is the format checker
					case 1:
<span class="fc" id="L435">						gamesPlayed1e = temp;</span>
<span class="fc" id="L436">						break;</span>
					case 2:
<span class="fc" id="L438">						gamesWon1e = temp;</span>
<span class="fc" id="L439">						break;</span>
					case 3:
<span class="fc" id="L441">						winStreak1e = temp;</span>
<span class="fc" id="L442">						break;</span>
					case 4:
<span class="fc" id="L444">						lossStreak1e = temp;</span>
<span class="fc" id="L445">						break;</span>
					case 5:
<span class="fc" id="L447">						currentStreak1e = temp;</span>
<span class="fc" id="L448">						break;</span>

					case 6:
<span class="fc" id="L451">						gamesPlayed1m = temp;</span>
<span class="fc" id="L452">						break;</span>
					case 7:
<span class="fc" id="L454">						gamesWon1m = temp;</span>
<span class="fc" id="L455">						break;</span>
					case 8:
<span class="fc" id="L457">						winStreak1m = temp;</span>
<span class="fc" id="L458">						break;</span>
					case 9:
<span class="fc" id="L460">						lossStreak1m = temp;</span>
<span class="fc" id="L461">						break;</span>
					case 10:
<span class="fc" id="L463">						currentStreak1m = temp;</span>
<span class="fc" id="L464">						break;</span>

					case 11:
<span class="fc" id="L467">						gamesPlayed1h = temp;</span>
<span class="fc" id="L468">						break;</span>
					case 12:
<span class="fc" id="L470">						gamesWon1h = temp;</span>
<span class="fc" id="L471">						break;</span>
					case 13:
<span class="fc" id="L473">						winStreak1h = temp;</span>
<span class="fc" id="L474">						break;</span>
					case 14:
<span class="fc" id="L476">						lossStreak1h = temp;</span>
<span class="fc" id="L477">						break;</span>
					case 15:
<span class="fc" id="L479">						currentStreak1h = temp;</span>
<span class="fc" id="L480">						break;</span>

					case 16:
<span class="fc" id="L483">						gamesPlayed3e = temp;</span>
<span class="fc" id="L484">						break;</span>
					case 17:
<span class="fc" id="L486">						gamesWon3e = temp;</span>
<span class="fc" id="L487">						break;</span>
					case 18:
<span class="fc" id="L489">						winStreak3e = temp;</span>
<span class="fc" id="L490">						break;</span>
					case 19:
<span class="fc" id="L492">						lossStreak3e = temp;</span>
<span class="fc" id="L493">						break;</span>
					case 20:
<span class="fc" id="L495">						currentStreak3e = temp;</span>
<span class="fc" id="L496">						break;</span>

					case 21:
<span class="fc" id="L499">						gamesPlayed3m = temp;</span>
<span class="fc" id="L500">						break;</span>
					case 22:
<span class="fc" id="L502">						gamesWon3m = temp;</span>
<span class="fc" id="L503">						break;</span>
					case 23:
<span class="fc" id="L505">						winStreak3m = temp;</span>
<span class="fc" id="L506">						break;</span>
					case 24:
<span class="fc" id="L508">						lossStreak3m = temp;</span>
<span class="fc" id="L509">						break;</span>
					case 25:
<span class="fc" id="L511">						currentStreak3m = temp;</span>
<span class="fc" id="L512">						break;</span>

					case 26:
<span class="fc" id="L515">						gamesPlayed3h = temp;</span>
<span class="fc" id="L516">						break;</span>
					case 27:
<span class="fc" id="L518">						gamesWon3h = temp;</span>
<span class="fc" id="L519">						break;</span>
					case 28:
<span class="fc" id="L521">						winStreak3h = temp;</span>
<span class="fc" id="L522">						break;</span>
					case 29:
<span class="fc" id="L524">						lossStreak3h = temp;</span>
<span class="fc" id="L525">						break;</span>
					case 30:
<span class="fc" id="L527">						currentStreak3h = temp;</span>
<span class="fc" id="L528">						break;</span>

					default:
						;
						break;
					}

<span class="fc" id="L535">					count++;</span>
				}
			}

<span class="fc" id="L539">			input.close();</span>
<span class="pc" id="L540">		} catch (Exception ex) {</span>
<span class="nc" id="L541">			System.out.println(ex);</span>
		}

		try {
<span class="fc" id="L545">			DataOutputStream output = new DataOutputStream(new FileOutputStream(file));</span>

<span class="fc bfc" id="L547" title="All 2 branches covered.">			if (winOrLoss == GAME_WON) {</span>
<span class="pc bpc" id="L548" title="1 of 2 branches missed.">				if (drawCount == 3) {</span>
<span class="nc bnc" id="L549" title="All 2 branches missed.">					if (difficulty == 1) {</span>
<span class="nc" id="L550">						gamesPlayed3e++;</span>
<span class="nc" id="L551">						gamesWon3e++;</span>

<span class="nc bnc" id="L553" title="All 2 branches missed.">						if (currentStreak3e &gt;= 0) {</span>
<span class="nc" id="L554">							currentStreak3e++;</span>
<span class="nc" id="L555">						} else {</span>
<span class="nc" id="L556">							currentStreak3e = 1;</span>
						}

<span class="nc bnc" id="L559" title="All 2 branches missed.">						if (winStreak3e &lt; currentStreak3e) {</span>
<span class="nc" id="L560">							winStreak3e = currentStreak3e;</span>
						}
<span class="nc bnc" id="L562" title="All 2 branches missed.">					} else if (difficulty == 2) {</span>
<span class="nc" id="L563">						gamesPlayed3m++;</span>
<span class="nc" id="L564">						gamesWon3m++;</span>

<span class="nc bnc" id="L566" title="All 2 branches missed.">						if (currentStreak3m &gt;= 0) {</span>
<span class="nc" id="L567">							currentStreak3m++;</span>
<span class="nc" id="L568">						} else {</span>
<span class="nc" id="L569">							currentStreak3m = 1;</span>
						}

<span class="nc bnc" id="L572" title="All 2 branches missed.">						if (winStreak3m &lt; currentStreak3m) {</span>
<span class="nc" id="L573">							winStreak3m = currentStreak3m;</span>
						}
<span class="nc" id="L575">					} else {</span>
<span class="nc" id="L576">						gamesPlayed3h++;</span>
<span class="nc" id="L577">						gamesWon3h++;</span>

<span class="nc bnc" id="L579" title="All 2 branches missed.">						if (currentStreak3h &gt;= 0) {</span>
<span class="nc" id="L580">							currentStreak3h++;</span>
<span class="nc" id="L581">						} else {</span>
<span class="nc" id="L582">							currentStreak3h = 1;</span>
						}

<span class="nc bnc" id="L585" title="All 2 branches missed.">						if (winStreak3h &lt; currentStreak3h) {</span>
<span class="nc" id="L586">							winStreak3h = currentStreak3h;</span>
						}
					}
<span class="nc" id="L589">				} else // if(drawCount == 1)</span>
				{
<span class="pc bpc" id="L591" title="1 of 2 branches missed.">					if (difficulty == 1) {</span>
<span class="fc" id="L592">						gamesPlayed1e++;</span>
<span class="fc" id="L593">						gamesWon1e++;</span>

<span class="fc bfc" id="L595" title="All 2 branches covered.">						if (currentStreak1e &gt;= 0) {</span>
<span class="fc" id="L596">							currentStreak1e++;</span>
<span class="fc" id="L597">						} else {</span>
<span class="fc" id="L598">							currentStreak1e = 1;</span>
						}

<span class="pc bpc" id="L601" title="1 of 2 branches missed.">						if (winStreak1e &lt; currentStreak1e) {</span>
<span class="fc" id="L602">							winStreak1e = currentStreak1e;</span>
						}
<span class="pc bnc" id="L604" title="All 2 branches missed.">					} else if (difficulty == 2) {</span>
<span class="nc" id="L605">						gamesPlayed1m++;</span>
<span class="nc" id="L606">						gamesWon1m++;</span>

<span class="nc bnc" id="L608" title="All 2 branches missed.">						if (currentStreak1m &gt;= 0) {</span>
<span class="nc" id="L609">							currentStreak1m++;</span>
<span class="nc" id="L610">						} else {</span>
<span class="nc" id="L611">							currentStreak1m = 1;</span>
						}

<span class="nc bnc" id="L614" title="All 2 branches missed.">						if (winStreak1m &lt; currentStreak1m) {</span>
<span class="nc" id="L615">							winStreak1m = currentStreak1m;</span>
						}
<span class="nc" id="L617">					} else {</span>
<span class="nc" id="L618">						gamesPlayed1h++;</span>
<span class="nc" id="L619">						gamesWon1h++;</span>

<span class="nc bnc" id="L621" title="All 2 branches missed.">						if (currentStreak1h &gt;= 0) {</span>
<span class="nc" id="L622">							currentStreak1h++;</span>
<span class="nc" id="L623">						} else {</span>
<span class="nc" id="L624">							currentStreak1h = 1;</span>
						}

<span class="nc bnc" id="L627" title="All 2 branches missed.">						if (winStreak1h &lt; currentStreak1h) {</span>
<span class="nc" id="L628">							winStreak1h = currentStreak1h;</span>
						}
					}
				}
<span class="pc bfc" id="L632" title="All 2 branches covered.">			} else if (winOrLoss == RESET_STATS) {</span>
<span class="fc" id="L633">				gamesWon1e = 0;</span>
<span class="fc" id="L634">				gamesPlayed1e = 0;</span>
<span class="fc" id="L635">				currentStreak1e = 0;</span>
<span class="fc" id="L636">				winStreak1e = 0;</span>
<span class="fc" id="L637">				lossStreak1e = 0;</span>

<span class="fc" id="L639">				gamesWon1m = 0;</span>
<span class="fc" id="L640">				gamesPlayed1m = 0;</span>
<span class="fc" id="L641">				currentStreak1m = 0;</span>
<span class="fc" id="L642">				winStreak1m = 0;</span>
<span class="fc" id="L643">				lossStreak1m = 0;</span>

<span class="fc" id="L645">				gamesWon1h = 0;</span>
<span class="fc" id="L646">				gamesPlayed1h = 0;</span>
<span class="fc" id="L647">				currentStreak1h = 0;</span>
<span class="fc" id="L648">				winStreak1h = 0;</span>
<span class="fc" id="L649">				lossStreak1h = 0;</span>

<span class="fc" id="L651">				gamesWon3e = 0;</span>
<span class="fc" id="L652">				gamesPlayed3e = 0;</span>
<span class="fc" id="L653">				currentStreak3e = 0;</span>
<span class="fc" id="L654">				winStreak3e = 0;</span>
<span class="fc" id="L655">				lossStreak3e = 0;</span>

<span class="fc" id="L657">				gamesWon3m = 0;</span>
<span class="fc" id="L658">				gamesPlayed3m = 0;</span>
<span class="fc" id="L659">				currentStreak3m = 0;</span>
<span class="fc" id="L660">				winStreak3m = 0;</span>
<span class="fc" id="L661">				lossStreak3m = 0;</span>

<span class="fc" id="L663">				gamesWon3h = 0;</span>
<span class="fc" id="L664">				gamesPlayed3h = 0;</span>
<span class="fc" id="L665">				currentStreak3h = 0;</span>
<span class="fc" id="L666">				winStreak3h = 0;</span>
<span class="fc" id="L667">				lossStreak3h = 0;</span>
<span class="fc bfc" id="L668" title="All 4 branches covered.">			} else if (winOrLoss == DO_NOTHING || winOrLoss == GAME_SAVED) {</span>
				// just updating options
			} else {
<span class="fc bfc" id="L671" title="All 2 branches covered.">				if (drawCount == 3) {</span>
<span class="pc bpc" id="L672" title="1 of 2 branches missed.">					if (difficulty == 1) {</span>
<span class="nc" id="L673">						gamesPlayed3e++;</span>

<span class="nc bnc" id="L675" title="All 2 branches missed.">						if (currentStreak3e &lt;= 0) {</span>
<span class="nc" id="L676">							currentStreak3e--;</span>
<span class="nc" id="L677">						} else {</span>
<span class="nc" id="L678">							currentStreak3e = -1;</span>
						}

<span class="nc bnc" id="L681" title="All 2 branches missed.">						if (lossStreak3e &gt; currentStreak3e) {</span>
<span class="nc" id="L682">							lossStreak3e = currentStreak3e;</span>
						}
<span class="pc bpc" id="L684" title="1 of 2 branches missed.">					} else if (difficulty == 2) {</span>
<span class="nc" id="L685">						gamesPlayed3m++;</span>

<span class="nc bnc" id="L687" title="All 2 branches missed.">						if (currentStreak3m &lt;= 0) {</span>
<span class="nc" id="L688">							currentStreak3m--;</span>
<span class="nc" id="L689">						} else {</span>
<span class="nc" id="L690">							currentStreak3m = -1;</span>
						}

<span class="nc bnc" id="L693" title="All 2 branches missed.">						if (lossStreak3m &gt; currentStreak3m) {</span>
<span class="nc" id="L694">							lossStreak3m = currentStreak3m;</span>
						}
<span class="nc" id="L696">					} else {</span>
<span class="fc" id="L697">						gamesPlayed3h++;</span>

<span class="pc bpc" id="L699" title="1 of 2 branches missed.">						if (currentStreak3h &lt;= 0) {</span>
<span class="fc" id="L700">							currentStreak3h--;</span>
<span class="fc" id="L701">						} else {</span>
<span class="nc" id="L702">							currentStreak3h = -1;</span>
						}

<span class="pc bpc" id="L705" title="1 of 2 branches missed.">						if (lossStreak3h &gt; currentStreak3h) {</span>
<span class="fc" id="L706">							lossStreak3h = currentStreak3h;</span>
						}
					}
<span class="fc" id="L709">				} else // if(drawCount == 1)</span>
				{
<span class="fc bfc" id="L711" title="All 2 branches covered.">					if (difficulty == 1) {</span>
<span class="fc" id="L712">						gamesPlayed1e++;</span>

<span class="pc bpc" id="L714" title="1 of 2 branches missed.">						if (currentStreak1e &lt;= 0) {</span>
<span class="fc" id="L715">							currentStreak1e--;</span>
<span class="fc" id="L716">						} else {</span>
<span class="nc" id="L717">							currentStreak1e = -1;</span>
						}

<span class="pc bpc" id="L720" title="1 of 2 branches missed.">						if (lossStreak1e &gt; currentStreak1e) {</span>
<span class="fc" id="L721">							lossStreak1e = currentStreak1e;</span>
						}
<span class="fc bfc" id="L723" title="All 2 branches covered.">					} else if (difficulty == 2) {</span>
<span class="fc" id="L724">						gamesPlayed1m++;</span>

<span class="pc bpc" id="L726" title="1 of 2 branches missed.">						if (currentStreak1m &lt;= 0) {</span>
<span class="fc" id="L727">							currentStreak1m--;</span>
<span class="fc" id="L728">						} else {</span>
<span class="nc" id="L729">							currentStreak1m = -1;</span>
						}

<span class="pc bpc" id="L732" title="1 of 2 branches missed.">						if (lossStreak1m &gt; currentStreak1m) {</span>
<span class="fc" id="L733">							lossStreak1m = currentStreak1m;</span>
						}
<span class="fc" id="L735">					} else {</span>
<span class="fc" id="L736">						gamesPlayed1h++;</span>

<span class="pc bpc" id="L738" title="1 of 2 branches missed.">						if (currentStreak1h &lt;= 0) {</span>
<span class="fc" id="L739">							currentStreak1h--;</span>
<span class="fc" id="L740">						} else {</span>
<span class="nc" id="L741">							currentStreak1h = -1;</span>
						}

<span class="pc bpc" id="L744" title="1 of 2 branches missed.">						if (lossStreak1h &gt; currentStreak1h) {</span>
<span class="fc" id="L745">							lossStreak1h = currentStreak1h;</span>
						}
					}
				}
			}

<span class="fc" id="L751">			output.writeInt(-1); // New format indicator</span>

<span class="fc" id="L753">			output.writeInt(gamesPlayed1e);</span>
<span class="fc" id="L754">			output.writeInt(gamesWon1e);</span>
<span class="fc" id="L755">			output.writeInt(winStreak1e);</span>
<span class="fc" id="L756">			output.writeInt(lossStreak1e);</span>
<span class="fc" id="L757">			output.writeInt(currentStreak1e);</span>

<span class="fc" id="L759">			output.writeInt(gamesPlayed1m);</span>
<span class="fc" id="L760">			output.writeInt(gamesWon1m);</span>
<span class="fc" id="L761">			output.writeInt(winStreak1m);</span>
<span class="fc" id="L762">			output.writeInt(lossStreak1m);</span>
<span class="fc" id="L763">			output.writeInt(currentStreak1m);</span>

<span class="fc" id="L765">			output.writeInt(gamesPlayed1h);</span>
<span class="fc" id="L766">			output.writeInt(gamesWon1h);</span>
<span class="fc" id="L767">			output.writeInt(winStreak1h);</span>
<span class="fc" id="L768">			output.writeInt(lossStreak1h);</span>
<span class="fc" id="L769">			output.writeInt(currentStreak1h);</span>

<span class="fc" id="L771">			output.writeInt(gamesPlayed3e);</span>
<span class="fc" id="L772">			output.writeInt(gamesWon3e);</span>
<span class="fc" id="L773">			output.writeInt(winStreak3e);</span>
<span class="fc" id="L774">			output.writeInt(lossStreak3e);</span>
<span class="fc" id="L775">			output.writeInt(currentStreak3e);</span>

<span class="fc" id="L777">			output.writeInt(gamesPlayed3m);</span>
<span class="fc" id="L778">			output.writeInt(gamesWon3m);</span>
<span class="fc" id="L779">			output.writeInt(winStreak3m);</span>
<span class="fc" id="L780">			output.writeInt(lossStreak3m);</span>
<span class="fc" id="L781">			output.writeInt(currentStreak3m);</span>

<span class="fc" id="L783">			output.writeInt(gamesPlayed3h);</span>
<span class="fc" id="L784">			output.writeInt(gamesWon3h);</span>
<span class="fc" id="L785">			output.writeInt(winStreak3h);</span>
<span class="fc" id="L786">			output.writeInt(lossStreak3h);</span>
<span class="fc" id="L787">			output.writeInt(currentStreak3h);</span>

<span class="fc" id="L789">			output.writeInt(drawCount);</span>
<span class="fc" id="L790">			output.writeInt(newDrawCount);</span>
<span class="fc" id="L791">			output.writeInt(deckNumber);</span>
<span class="fc" id="L792">			output.writeInt(backgroundNumber);</span>
<span class="fc" id="L793">			output.writeInt(timerToRunNextGame);</span>

<span class="fc" id="L795">			output.writeInt(winAnimationStatus); // Finish saving options</span>
<span class="fc" id="L796">			output.writeInt(winSoundsStatus);</span>
<span class="fc" id="L797">			output.writeInt(dealDeck.getDeckThroughs());</span>
<span class="fc" id="L798">			output.writeInt(difficulty);</span>
<span class="fc" id="L799">			output.writeInt(newDifficulty);</span>

<span class="fc" id="L801">			File savedFile = new File(fileLocation + &quot;frs-savedgame.dat&quot;);</span>
<span class="fc" id="L802">			DataOutputStream saved = new DataOutputStream(new FileOutputStream(savedFile));</span>

<span class="fc bfc" id="L804" title="All 2 branches covered.">			if (winOrLoss == GAME_SAVED) {</span>
<span class="fc" id="L805">				output.writeInt(1); // Saved</span>

<span class="fc bfc" id="L807" title="All 2 branches covered.">				for (int i = 0; i &lt; cells.length; i++) {</span>
<span class="pc bpc" id="L808" title="1 of 2 branches missed.">					if (!cells[i].isEmpty()) {</span>
<span class="fc" id="L809">						saved.writeInt(cells[i].peek().getFullNumber());</span>
<span class="fc" id="L810">						saved.writeInt(-1);</span>
<span class="fc" id="L811">					} else {</span>
<span class="nc" id="L812">						saved.writeInt(-1);</span>
					}
				}

<span class="fc bfc" id="L816" title="All 2 branches covered.">				for (int i = 0; i &lt; columns.length; i++) {</span>
<span class="pc bpc" id="L817" title="1 of 2 branches missed.">					if (!columns[i].isEmpty()) {</span>
<span class="fc bfc" id="L818" title="All 2 branches covered.">						for (int j = 0; j &lt; columns[i].length(); j++) {</span>
<span class="fc" id="L819">							saved.writeInt(columns[i].getCardAtLocation(j).getFullNumber());</span>
						}

<span class="fc" id="L822">						saved.writeInt(-1);</span>
<span class="fc" id="L823">					} else {</span>
<span class="nc" id="L824">						saved.writeInt(-1);</span>
					}
				}

<span class="fc bfc" id="L828" title="All 2 branches covered.">				for (int i = 0; i &lt; acePiles.length; i++) {</span>
<span class="pc bpc" id="L829" title="1 of 2 branches missed.">					if (!acePiles[i].isEmpty()) {</span>
<span class="nc bnc" id="L830" title="All 2 branches missed.">						for (int j = 0; j &lt; acePiles[i].length(); j++) {</span>
<span class="nc" id="L831">							saved.writeInt(acePiles[i].getCardAtLocation(j).getFullNumber());</span>
						}

<span class="nc" id="L834">						saved.writeInt(-1);</span>
<span class="nc" id="L835">					} else {</span>
<span class="fc" id="L836">						saved.writeInt(-1);</span>
					}
				}

<span class="pc bpc" id="L840" title="1 of 2 branches missed.">				if (!dealDeck.isEmpty()) {</span>
<span class="fc bfc" id="L841" title="All 2 branches covered.">					for (int j = 0; j &lt; dealDeck.length(); j++) {</span>
<span class="fc" id="L842">						saved.writeInt(dealDeck.getCardAtLocation(j).getFullNumber());</span>
					}

<span class="fc" id="L845">					saved.writeInt(-1);</span>
<span class="fc" id="L846">				} else {</span>
<span class="nc" id="L847">					saved.writeInt(-1);</span>
				}

<span class="pc bpc" id="L850" title="1 of 2 branches missed.">				if (!discardPile.isEmpty()) {</span>
<span class="nc bnc" id="L851" title="All 2 branches missed.">					for (int j = 0; j &lt; discardPile.length(); j++) {</span>
<span class="nc" id="L852">						saved.writeInt(discardPile.getCardAtLocation(j).getFullNumber());</span>
					}

<span class="nc" id="L855">					saved.writeInt(-1);</span>
<span class="nc" id="L856">				} else {</span>
<span class="fc" id="L857">					saved.writeInt(-1);</span>
				}
<span class="fc" id="L859">			} else {</span>
<span class="fc" id="L860">				output.writeInt(0); // Not saved</span>
<span class="fc" id="L861">				savedFile.delete();</span>
			}

<span class="fc" id="L864">			output.close();</span>
<span class="fc" id="L865">			saved.close();</span>
<span class="pc" id="L866">		} catch (Exception ex) {</span>
<span class="nc" id="L867">			ex.printStackTrace();</span>
		}
<span class="fc" id="L869">	}</span>

	public void setAppearance(int deck, int background) {
<span class="fc" id="L872">		deckNumber = deck;</span>
<span class="fc" id="L873">		backgroundNumber = background;</span>

<span class="fc" id="L875">		mainPanel.changeBackground(backgroundNumber);</span>
<span class="fc" id="L876">	}</span>

	public int getDrawCount() {
<span class="nc" id="L879">		return drawCount;</span>
	}

	public void setDrawCount(int draw) {
<span class="fc" id="L883">		drawCount = draw;</span>

<span class="pc bpc" id="L885" title="2 of 4 branches missed.">		if (drawCount != 3 &amp;&amp; drawCount != 1) {</span>
<span class="nc" id="L886">			drawCount = 1;</span>
		}
<span class="fc" id="L888">	}</span>

	public int getNewDrawCount() {
<span class="fc" id="L891">		return newDrawCount;</span>
	}

	public void setNewDrawCount(int draw) {
<span class="fc" id="L895">		newDrawCount = draw;</span>

<span class="pc bpc" id="L897" title="1 of 4 branches missed.">		if (newDrawCount != 3 &amp;&amp; newDrawCount != 1) {</span>
<span class="nc" id="L898">			newDrawCount = 1;</span>
		}
<span class="fc" id="L900">	}</span>

	public int getDeckNumber() {
<span class="fc" id="L903">		return deckNumber;</span>
	}

	public void setDeckNumber(int deckNum) {
<span class="fc" id="L907">		deckNumber = deckNum;</span>

<span class="pc bpc" id="L909" title="1 of 2 branches missed.">		if (deckNumber &gt; ChangeAppearance.NUM_DECKS) {</span>
<span class="nc" id="L910">			deckNumber = ChangeAppearance.FRS_DECK;</span>
		}
<span class="fc" id="L912">	}</span>

	public int getBackgroundNumber() {
<span class="fc" id="L915">		return backgroundNumber;</span>
	}

	public void setBackgroundNumber(int backNum) {
<span class="fc" id="L919">		backgroundNumber = backNum;</span>

<span class="pc bpc" id="L921" title="1 of 2 branches missed.">		if (backgroundNumber &gt; ChangeAppearance.NUM_BACKGROUNDS) {</span>
<span class="nc" id="L922">			backgroundNumber = ChangeAppearance.FRS_BACKGROUND;</span>
		}
<span class="fc" id="L924">	}</span>

	public int getTimerNextGameStatus() {
<span class="fc" id="L927">		return timerToRunNextGame;</span>
	}

	public int getTimerStatus() {
<span class="nc bnc" id="L931" title="All 2 branches missed.">		if (timer.isRunning()) {</span>
<span class="nc" id="L932">			return 1;</span>
		} else {
<span class="nc" id="L934">			return 0;</span>
		}
	}

	public void setTimerStatus(int timerInt) {
<span class="pc bpc" id="L939" title="1 of 4 branches missed.">		if (timerInt == 1 &amp;&amp; !timer.isRunning()) {</span>
<span class="fc" id="L940">			timerToRunNextGame = 1;</span>
<span class="pc bpc" id="L941" title="1 of 4 branches missed.">		} else if (timerInt == 0 &amp;&amp; timer.isRunning()) {</span>
<span class="fc" id="L942">			timerToRunNextGame = 0;</span>
		}

<span class="pc bpc" id="L945" title="1 of 4 branches missed.">		if (timerInt != 0 &amp;&amp; timerInt != 1) {</span>
<span class="nc" id="L946">			timerToRunNextGame = 0;</span>
		}
<span class="fc" id="L948">	}</span>

	public int getWinAnimationStatus() {
<span class="fc" id="L951">		return winAnimationStatus;</span>
	}

	public void setWinAnimationStatus(int animation) {
<span class="fc" id="L955">		winAnimationStatus = animation;</span>

<span class="pc bpc" id="L957" title="1 of 4 branches missed.">		if (winAnimationStatus != 0 &amp;&amp; winAnimationStatus != 1) {</span>
<span class="nc" id="L958">			winAnimationStatus = 0;</span>
		}
<span class="fc" id="L960">	}</span>

	public int getWinSoundsStatus() {
<span class="fc" id="L963">		return winSoundsStatus;</span>
	}

	public void setWinSoundsStatus(int sounds) {
<span class="fc" id="L967">		winSoundsStatus = sounds;</span>

<span class="pc bpc" id="L969" title="1 of 4 branches missed.">		if (winSoundsStatus != 0 &amp;&amp; winSoundsStatus != 1) {</span>
<span class="nc" id="L970">			winSoundsStatus = 0;</span>
		}
<span class="fc" id="L972">	}</span>

	public int getDifficulty() {
<span class="nc" id="L975">		return difficulty;</span>
	}

	public void setDifficulty(int difficulty) {
<span class="pc bpc" id="L979" title="2 of 4 branches missed.">		if (difficulty &gt; 3 || difficulty &lt; 1) {</span>
<span class="nc" id="L980">			this.difficulty = 2;</span>
<span class="nc" id="L981">		} else {</span>
<span class="fc" id="L982">			this.difficulty = difficulty;</span>
		}
<span class="fc" id="L984">	}</span>

	public int getNewDifficulty() {
<span class="fc" id="L987">		return newDifficulty;</span>
	}

	public void setNewDifficulty(int newDifficulty) {
<span class="pc bpc" id="L991" title="2 of 4 branches missed.">		if (newDifficulty &gt; 3 || newDifficulty &lt; 1) {</span>
<span class="nc" id="L992">			this.newDifficulty = 2;</span>
<span class="nc" id="L993">		} else {</span>
<span class="fc" id="L994">			this.newDifficulty = newDifficulty;</span>
		}
<span class="fc" id="L996">	}</span>

	public void setDeckThroughs(int deckThroughs) {
<span class="fc" id="L999">		dealDeck.setDeckThroughs(deckThroughs);</span>
<span class="fc" id="L1000">	}</span>

	public synchronized void undoMove() {
<span class="pc bpc" id="L1003" title="1 of 2 branches missed.">		if (!sourceList.isEmpty()) {</span>
			// if player is holding on to a card
<span class="pc bpc" id="L1005" title="1 of 2 branches missed.">			if (sourceList.size() &gt; destinationList.size()) {</span>
<span class="nc" id="L1006">				CardStack tempSource = sourceList.getLast();</span>
<span class="nc" id="L1007">				sourceList.removeLast();</span>

<span class="nc" id="L1009">				int num = numCards.getLast();</span>
<span class="nc" id="L1010">				numCards.removeLast();</span>

<span class="nc" id="L1012">				int numDiscard = numCardsInDiscardView.getLast();</span>
<span class="nc" id="L1013">				numCardsInDiscardView.removeLast();</span>

<span class="nc bnc" id="L1015" title="All 2 branches missed.">				if (num == 1) {</span>
<span class="nc" id="L1016">					discardPile.setView(numDiscard);</span>
<span class="nc" id="L1017">					tempSource.peek().unhighlight();</span>

<span class="nc" id="L1019">					ml.clickedCard = null;</span>
<span class="nc" id="L1020">					ml.hasSelected = false;</span>
<span class="nc" id="L1021">					ml.singleCardSelected = false;</span>
<span class="nc" id="L1022">					ml.temp = null;</span>
<span class="nc" id="L1023">				} else {</span>
<span class="nc bnc" id="L1024" title="All 2 branches missed.">					for (int i = 0; i &lt; num; i++) {</span>
<span class="nc" id="L1025">						tempSource.getCardAtLocation(tempSource.length() - i - 1).unhighlight();</span>
					}

<span class="nc" id="L1028">					ml.clickedCard = null;</span>
<span class="nc" id="L1029">					ml.hasSelected = false;</span>
<span class="nc" id="L1030">					ml.temp = null;</span>
				}

<span class="nc" id="L1033">				tempSource.repaint();</span>
<span class="pc bpc" id="L1034" title="1 of 2 branches missed.">			} else if (!(sourceList.getLast() instanceof DealDeck)) {</span>
<span class="fc" id="L1035">				CardStack tempSource = sourceList.getLast();</span>
<span class="fc" id="L1036">				CardStack tempDest = destinationList.getLast();</span>
<span class="fc" id="L1037">				int num = numCards.getLast();</span>
<span class="fc" id="L1038">				int numDiscard = numCardsInDiscardView.getLast();</span>

<span class="fc" id="L1040">				sourceList.removeLast();</span>
<span class="fc" id="L1041">				destinationList.removeLast();</span>
<span class="fc" id="L1042">				numCards.removeLast();</span>
<span class="fc" id="L1043">				numCardsInDiscardView.removeLast();</span>

<span class="pc bpc" id="L1045" title="1 of 2 branches missed.">				if (num == 1) {</span>
<span class="fc" id="L1046">					tempSource.addCard(tempDest.pop());</span>
<span class="fc" id="L1047">				} else {</span>
<span class="nc" id="L1048">					CardStack temp = tempDest.getStack(num);</span>
<span class="nc" id="L1049">					tempSource.addStack(temp);</span>
				}

<span class="fc" id="L1052">				discardPile.setView(numDiscard);</span>
<span class="fc" id="L1053">				tempSource.repaint();</span>
<span class="fc" id="L1054">				tempDest.repaint();</span>
<span class="fc" id="L1055">			}</span>
			// The last draw from the deck didn't reset the discard pile to make it an empty
			// pile
<span class="nc bnc" id="L1058" title="All 4 branches missed.">			else if (sourceList.getLast() instanceof DealDeck &amp;&amp; !destinationList.getLast().isEmpty()) {</span>
<span class="nc" id="L1059">				int num = numCards.getLast();</span>
<span class="nc" id="L1060">				int numDiscard = numCardsInDiscardView.getLast();</span>

<span class="nc" id="L1062">				sourceList.removeLast();</span>
<span class="nc" id="L1063">				destinationList.removeLast();</span>
<span class="nc" id="L1064">				numCards.removeLast();</span>
<span class="nc" id="L1065">				numCardsInDiscardView.removeLast();</span>

<span class="nc bnc" id="L1067" title="All 2 branches missed.">				for (int i = 0; i &lt; num; i++) {</span>
<span class="nc" id="L1068">					Card card = discardPile.undoPop();</span>
<span class="nc" id="L1069">					card.setFaceDown();</span>
<span class="nc" id="L1070">					dealDeck.addCard(card);</span>
				}

<span class="nc" id="L1073">				discardPile.setView(numDiscard);</span>
<span class="nc" id="L1074">				dealDeck.repaint();</span>
<span class="nc" id="L1075">				discardPile.repaint();</span>
<span class="nc" id="L1076">			}</span>
			// Last move was a reset on the discard pile
<span class="nc bnc" id="L1078" title="All 2 branches missed.">			else if (sourceList.getLast() instanceof DealDeck) {</span>
<span class="nc" id="L1079">				dealDeck.undoPop();</span>

<span class="nc" id="L1081">				int numDiscard = numCardsInDiscardView.getLast();</span>
<span class="nc" id="L1082">				discardPile.setView(numDiscard);</span>

<span class="nc" id="L1084">				discardPile.repaint();</span>
<span class="nc" id="L1085">				discardPile.revalidate();</span>
<span class="nc" id="L1086">				dealDeck.repaint();</span>

<span class="nc" id="L1088">				sourceList.removeLast();</span>
<span class="nc" id="L1089">				destinationList.removeLast();</span>
<span class="nc" id="L1090">				numCards.removeLast();</span>
<span class="nc" id="L1091">				numCardsInDiscardView.removeLast();</span>
			}
		}
<span class="fc" id="L1094">	}</span>

	@SuppressWarnings(&quot;fallthrough&quot;)
	public void getHint() {
<span class="fc" id="L1098">		CardStack source = new CardStack();</span>
<span class="fc" id="L1099">		CardStack destination = new CardStack();</span>
<span class="fc" id="L1100">		CardStack temp = new CardStack();</span>

<span class="fc" id="L1102">		LinkedList&lt;String&gt; hints = new LinkedList&lt;String&gt;();</span>
<span class="fc" id="L1103">		String sourceString = &quot;&quot;;</span>

<span class="fc bfc" id="L1105" title="All 2 branches covered.">		for (int i = 0; i &lt; 9; i++) {</span>
<span class="pc bpc" id="L1106" title="1 of 4 branches missed.">			switch (i) {</span>
			case 0:
				;
			case 1:
				;
			case 2:
				;
			case 3: {
<span class="fc" id="L1114">				source = columns[i];</span>
<span class="fc" id="L1115">				sourceString = &quot;Column &quot; + (i + 1);</span>
			}
<span class="fc" id="L1117">				break;</span>
			case 4:
				;
			case 5:
				;
			case 6:
				;
			case 7: {
<span class="fc" id="L1125">				source = cells[i - 4];</span>
<span class="fc" id="L1126">				sourceString = &quot;Cell &quot; + (i - 3);</span>
			}
<span class="fc" id="L1128">				break;</span>
			case 8: {
<span class="fc" id="L1130">				source = discardPile;</span>
<span class="fc" id="L1131">				sourceString = &quot;the Discard Pile&quot;;</span>
			}
<span class="fc" id="L1133">				break;</span>

			default:
				;
				break;
			}

<span class="pc bpc" id="L1140" title="1 of 4 branches missed.">			if (source != null &amp;&amp; !source.isEmpty()) {</span>
<span class="fc" id="L1141">				temp = source.getAvailableCards();</span>
<span class="fc" id="L1142">				String destinationString = &quot;&quot;;</span>

<span class="fc bfc" id="L1144" title="All 2 branches covered.">				for (int j = 0; j &lt; 8; j++) {</span>
<span class="pc bpc" id="L1145" title="1 of 3 branches missed.">					switch (j) {</span>
					case 0:
						;
					case 1:
						;
					case 2:
						;
					case 3: {
<span class="fc" id="L1153">						destination = columns[j];</span>
<span class="fc" id="L1154">						destinationString = &quot;Column &quot; + (j + 1);</span>
					}
<span class="fc" id="L1156">						break;</span>
					case 4:
						;
					case 5:
						;
					case 6:
						;
					case 7: {
<span class="fc" id="L1164">						destination = acePiles[j - 4];</span>
<span class="fc" id="L1165">						destinationString = &quot;its Ace Pile&quot;;</span>
					}
<span class="fc" id="L1167">						break;</span>

					default:
						;
						break;
					}

<span class="pc bpc" id="L1174" title="1 of 6 branches missed.">					if (destination != null &amp;&amp; !destination.isEmpty() &amp;&amp; destination != source</span>
<span class="pc bpc" id="L1175" title="1 of 2 branches missed.">							&amp;&amp; !(destination instanceof SingleCell)) {</span>
<span class="fc bfc" id="L1176" title="All 2 branches covered.">						for (int k = temp.length() - 1; k &gt;= 0; k--) {</span>
<span class="fc" id="L1177">							Card card = temp.getCardAtLocation(k);</span>

<span class="pc bpc" id="L1179" title="1 of 2 branches missed.">							if (((destination instanceof AcePile)</span>
<span class="nc bnc" id="L1180" title="All 2 branches missed.">									&amp;&amp; card.getSuit().equals(((AcePile) destination).getSuit())</span>
<span class="nc bnc" id="L1181" title="All 4 branches missed.">									&amp;&amp; card.getNumber() == (destination.peek().getNumber() + 1) &amp;&amp; k == 0)</span>
<span class="pc bpc" id="L1182" title="1 of 2 branches missed.">									|| (!(destination instanceof AcePile)</span>
<span class="fc bfc" id="L1183" title="All 2 branches covered.">											&amp;&amp; card.getColor() != destination.peek().getColor()</span>
<span class="fc bfc" id="L1184" title="All 2 branches covered.">											&amp;&amp; card.getNumber() == destination.peek().getNumber() - 1)) {</span>
<span class="fc" id="L1185">								String hintString = &quot;Move the &quot;;</span>

<span class="pc bpc" id="L1187" title="1 of 2 branches missed.">								if (card.getNumber() == 11) {</span>
<span class="nc" id="L1188">									hintString += &quot;Jack&quot;;</span>
<span class="pc bpc" id="L1189" title="1 of 2 branches missed.">								} else if (card.getNumber() == 12) {</span>
<span class="nc" id="L1190">									hintString += &quot;Queen&quot;;</span>
<span class="pc bpc" id="L1191" title="1 of 2 branches missed.">								} else if (card.getNumber() == 13) {</span>
<span class="nc" id="L1192">									hintString += &quot;King&quot;;</span>
<span class="pc bfc" id="L1193" title="All 2 branches covered.">								} else if (card.getNumber() == 1) {</span>
<span class="fc" id="L1194">									hintString += &quot;Ace&quot;;</span>
<span class="fc" id="L1195">								} else {</span>
<span class="fc" id="L1196">									hintString += card.getNumber();</span>
								}

<span class="fc" id="L1199">								hintString += &quot; of &quot; + card.getSuit() + &quot; in &quot; + sourceString + &quot; to the &quot;;</span>

<span class="pc bpc" id="L1201" title="1 of 2 branches missed.">								if (destination.peek().getNumber() == 11) {</span>
<span class="nc" id="L1202">									hintString += &quot;Jack&quot;;</span>
<span class="pc bpc" id="L1203" title="1 of 2 branches missed.">								} else if (destination.peek().getNumber() == 12) {</span>
<span class="nc" id="L1204">									hintString += &quot;Queen&quot;;</span>
<span class="pc bpc" id="L1205" title="1 of 2 branches missed.">								} else if (destination.peek().getNumber() == 13) {</span>
<span class="nc" id="L1206">									hintString += &quot;King&quot;;</span>
<span class="pc bpc" id="L1207" title="1 of 2 branches missed.">								} else if (destination.peek().getNumber() == 1) {</span>
<span class="nc" id="L1208">									hintString += &quot;Ace&quot;;</span>
<span class="nc" id="L1209">								} else {</span>
<span class="fc" id="L1210">									hintString += destination.peek().getNumber();</span>
								}

<span class="fc" id="L1213">								hintString += &quot; of &quot; + destination.peek().getSuit() + &quot; in &quot; + destinationString;</span>

<span class="fc" id="L1215">								hints.add(hintString);</span>
<span class="fc" id="L1216">								break; // Once a move is found from a source to destination, stop looking for more</span>
							}
						}
<span class="pc bpc" id="L1219" title="2 of 6 branches missed.">					} else if (destination != null &amp;&amp; destination != source &amp;&amp; (destination instanceof Column)</span>
<span class="nc bnc" id="L1220" title="All 4 branches missed.">							&amp;&amp; destination.isEmpty() &amp;&amp; source.getBottom().getNumber() != 13) {</span>
<span class="nc bnc" id="L1221" title="All 2 branches missed.">						for (int k = 0; k &lt; temp.length(); k++) {</span>
<span class="nc" id="L1222">							Card card = temp.getCardAtLocation(k);</span>

<span class="nc bnc" id="L1224" title="All 2 branches missed.">							if (card.getNumber() == 13) {</span>
<span class="nc" id="L1225">								String hintString = &quot;Move the King of &quot; + card.getSuit() + &quot; in &quot; + sourceString</span>
<span class="nc" id="L1226">										+ &quot; to the empty &quot; + destinationString;</span>

<span class="nc" id="L1228">								hints.add(hintString);</span>
<span class="nc" id="L1229">								break; // Once a move is found from a source to destination, stop looking for more</span>
							}
						}
<span class="pc bpc" id="L1232" title="2 of 6 branches missed.">					} else if (destination != null &amp;&amp; destination != source &amp;&amp; (destination instanceof AcePile)</span>
<span class="pc bpc" id="L1233" title="1 of 2 branches missed.">							&amp;&amp; destination.isEmpty()) {</span>
<span class="fc" id="L1234">						Card card = temp.peek();</span>

<span class="fc bfc" id="L1236" title="All 4 branches covered.">						if (card.getNumber() == 1 &amp;&amp; card.getSuit().equals(((AcePile) destination).getSuit())) {</span>
<span class="fc" id="L1237">							String hintString = &quot;Move the Ace of &quot; + card.getSuit() + &quot; in &quot; + sourceString + &quot; to &quot;</span>
<span class="fc" id="L1238">									+ destinationString;</span>

<span class="fc" id="L1240">							hints.add(hintString);</span>
<span class="fc" id="L1241">							break; // Once a move is found from a source to destination, stop looking for more</span>
						}
					}
				}
			}
		}

<span class="fc bfc" id="L1248" title="All 2 branches covered.">		for (int i = 0; i &lt; 4; i++) {</span>
<span class="pc bpc" id="L1249" title="1 of 2 branches missed.">			if (cells[i].isEmpty()) {</span>
<span class="nc" id="L1250">				String hintString = &quot;Move any available card to Cell &quot; + (i + 1);</span>
<span class="nc" id="L1251">				hints.add(hintString);</span>
			}
		}

<span class="pc bpc" id="L1255" title="1 of 2 branches missed.">		if (!hints.isEmpty()) {</span>
<span class="fc" id="L1256">			String string = &quot;&quot;;</span>

<span class="fc bfc" id="L1258" title="All 2 branches covered.">			for (int i = 0; i &lt; hints.size(); i++) {</span>
<span class="fc" id="L1259">				string += hints.get(i) + &quot;\n&quot;;</span>
			}

<span class="fc" id="L1262">			JOptionPane.showMessageDialog(this, string, &quot;Hints Galore&quot;, JOptionPane.INFORMATION_MESSAGE);</span>
<span class="fc" id="L1263">		} else {</span>
<span class="nc" id="L1264">			JOptionPane.showMessageDialog(this,</span>
<span class="nc" id="L1265">					&quot;There are no moves on the field.\n&quot; + &quot;Either deal more cards or start a new game&quot;, &quot;Hints&quot;,</span>
<span class="nc" id="L1266">					JOptionPane.INFORMATION_MESSAGE);</span>
		}
<span class="fc" id="L1268">	}</span>

<span class="fc" id="L1270">	private class MyMouseListener extends MouseInputAdapter {</span>
<span class="fc" id="L1271">		private boolean hasSelected = false; // If true, the player hasn't completed a move</span>
<span class="fc" id="L1272">		private boolean singleCardSelected = false; // If true, the selected stack is only one card</span>

		private Card clickedCard;
		private CardStack source;
		private CardStack destination;
		private CardStack temp;

		private Card tempCard; // For right clicking discard pile view
<span class="fc" id="L1280">		private boolean rightClicked = false; // To prevent clicking cards from the right click view</span>

		private void checkWin() {
<span class="fc bfc" id="L1283" title="All 2 branches covered.">			for (int i = 0; i &lt; 4; i++) {</span>
<span class="pc bpc" id="L1284" title="1 of 4 branches missed.">				if (acePiles[i].isEmpty() || acePiles[i].peek().getNumber() != Card.KING) {</span>
<span class="fc" id="L1285">					return;</span>
				}
			}

<span class="pc bpc" id="L1289" title="3 of 4 branches missed.">			if (winAnimationStatus != 0 || winSoundsStatus != 0) {</span>
<span class="fc" id="L1290">				new WinScreen(winAnimationStatus, winSoundsStatus);</span>
			}

<span class="fc" id="L1293">			int playAgain = JOptionPane.showConfirmDialog(SolitaireBoard.this, &quot;Play Again?&quot;, &quot;You Won!&quot;,</span>
<span class="fc" id="L1294">					JOptionPane.YES_NO_OPTION);</span>

<span class="fc bfc" id="L1296" title="All 2 branches covered.">			if (playAgain == JOptionPane.YES_OPTION) {</span>
<span class="fc" id="L1297">				recordGame(GAME_WON);</span>
<span class="fc" id="L1298">				newGame(GAME_WON);</span>
<span class="fc" id="L1299">			} else// (playAgain == JOptionPane.NO_OPTION)</span>
			{
<span class="fc" id="L1301">				recordGame(GAME_WON);</span>
<span class="nc" id="L1302">				System.exit(0);</span>
			}
<span class="fc" id="L1304">		}</span>

		public void mousePressed(MouseEvent e) {
<span class="fc bfc" id="L1307" title="All 4 branches covered.">			if (e.getButton() == MouseEvent.BUTTON3 &amp;&amp; e.getSource() == discardPile) {</span>
<span class="fc bfc" id="L1308" title="All 2 branches covered.">				if (discardPile.getNumViewableCards() == 1</span>
<span class="pc bpc" id="L1309" title="3 of 4 branches missed.">						|| (discardPile.getNumViewableCards() == 0 &amp;&amp; !discardPile.isEmpty())) {</span>
<span class="fc" id="L1310">					tempCard = discardPile.pop();</span>
<span class="fc" id="L1311">					discardPile.repaint();</span>
<span class="fc" id="L1312">					rightClicked = true;</span>
				}
			}
<span class="fc" id="L1315">		}</span>

		public void mouseReleased(MouseEvent e) {
<span class="fc bfc" id="L1318" title="All 4 branches covered.">			if (e.getButton() == MouseEvent.BUTTON3 &amp;&amp; tempCard != null) {</span>
<span class="fc" id="L1319">				discardPile.push(tempCard);</span>
<span class="fc" id="L1320">				discardPile.repaint();</span>
<span class="fc" id="L1321">				rightClicked = false;</span>
<span class="fc" id="L1322">				tempCard = null;</span>
			}
<span class="fc" id="L1324">		}</span>

		public void mouseClicked(MouseEvent e) {
<span class="fc bfc" id="L1327" title="All 4 branches covered.">			if (!timer.isRunning() &amp;&amp; timerToRun) {</span>
<span class="fc" id="L1328">				timer.start();</span>
			}

<span class="pc bpc" id="L1331" title="1 of 4 branches missed.">			if ((e.getButton() != MouseEvent.BUTTON1) || rightClicked) {</span>
<span class="fc" id="L1332">				return;</span>
			}

<span class="pc bpc" id="L1335" title="1 of 6 branches missed.">			else if (e.getClickCount() == 2 &amp;&amp; hasSelected &amp;&amp; singleCardSelected) {</span>
<span class="fc bfc" id="L1336" title="All 2 branches covered.">				if (source.peek().getNumber() == Card.ACE) {</span>
<span class="fc bfc" id="L1337" title="All 2 branches covered.">					if (source.peek().getSuit().equals(Card.SPADES_SUIT)) {</span>
<span class="fc" id="L1338">						Card card = source.pop();</span>
<span class="fc" id="L1339">						card.unhighlight();</span>
<span class="fc" id="L1340">						acePiles[0].push(card);</span>
<span class="fc" id="L1341">						destinationList.add(acePiles[0]);</span>
<span class="fc bfc" id="L1342" title="All 2 branches covered.">					} else if (source.peek().getSuit().equals(Card.CLUBS_SUIT)) {</span>
<span class="fc" id="L1343">						Card card = source.pop();</span>
<span class="fc" id="L1344">						card.unhighlight();</span>
<span class="fc" id="L1345">						acePiles[1].push(card);</span>
<span class="fc" id="L1346">						destinationList.add(acePiles[1]);</span>
<span class="fc bfc" id="L1347" title="All 2 branches covered.">					} else if (source.peek().getSuit().equals(Card.DIAMONDS_SUIT)) {</span>
<span class="fc" id="L1348">						Card card = source.pop();</span>
<span class="fc" id="L1349">						card.unhighlight();</span>
<span class="fc" id="L1350">						acePiles[2].push(card);</span>
<span class="fc" id="L1351">						destinationList.add(acePiles[2]);</span>
<span class="fc" id="L1352">					} else // if(source.peek().getSuit().equals(Card.HEARTS_SUIT))</span>
					{
<span class="fc" id="L1354">						Card card = source.pop();</span>
<span class="fc" id="L1355">						card.unhighlight();</span>
<span class="fc" id="L1356">						acePiles[3].push(card);</span>
<span class="fc" id="L1357">						destinationList.add(acePiles[3]);</span>
					}

<span class="fc" id="L1360">					hasSelected = false;</span>
<span class="fc" id="L1361">					source.repaint();</span>
<span class="fc" id="L1362">					repaint();</span>
<span class="fc" id="L1363">					return;</span>
				}

<span class="fc bfc" id="L1366" title="All 2 branches covered.">				for (int i = 0; i &lt; 4; i++) {</span>
<span class="pc bpc" id="L1367" title="1 of 4 branches missed.">					if (!acePiles[i].isEmpty() &amp;&amp; source.peek().getSuit().equals(acePiles[i].peek().getSuit())</span>
<span class="fc bfc" id="L1368" title="All 2 branches covered.">							&amp;&amp; source.peek().getNumber() == (acePiles[i].peek().getNumber() + 1)) {</span>
<span class="fc" id="L1369">						Card card = source.pop();</span>
<span class="fc" id="L1370">						card.unhighlight();</span>
<span class="fc" id="L1371">						acePiles[i].push(card);</span>

<span class="fc" id="L1373">						destinationList.add(acePiles[i]);</span>
<span class="fc" id="L1374">						hasSelected = false;</span>

<span class="fc" id="L1376">						source.repaint();</span>
<span class="fc" id="L1377">						repaint();</span>

<span class="fc bfc" id="L1379" title="All 2 branches covered.">						if (card.getNumber() == Card.KING) {</span>
<span class="fc" id="L1380">							checkWin();</span>
						}

<span class="fc" id="L1383">						return;</span>
					}
				}

<span class="pc bpc" id="L1387" title="1 of 2 branches missed.">				for (int i = 0; i &lt; 4; i++) {</span>
<span class="pc bpc" id="L1388" title="1 of 2 branches missed.">					if (cells[i].isEmpty()) {</span>
<span class="fc" id="L1389">						Card card = source.pop();</span>
<span class="fc" id="L1390">						card.unhighlight();</span>
<span class="fc" id="L1391">						cells[i].push(card);</span>

<span class="fc" id="L1393">						destinationList.add(cells[i]);</span>
<span class="fc" id="L1394">						hasSelected = false;</span>

<span class="fc" id="L1396">						source.repaint();</span>
<span class="fc" id="L1397">						repaint();</span>
<span class="fc" id="L1398">						return;</span>
					}
				}

<span class="nc" id="L1402">				source.peek().unhighlight();</span>

<span class="nc" id="L1404">				source.repaint();</span>
<span class="nc" id="L1405">				repaint();</span>
<span class="nc" id="L1406">				return;</span>
<span class="pc bpc" id="L1407" title="1 of 4 branches missed.">			} else if (e.getClickCount() == 2 &amp;&amp; hasSelected) {</span>
<span class="nc" id="L1408">				hasSelected = false;</span>

<span class="nc bnc" id="L1410" title="All 2 branches missed.">				if (temp.length() &gt; 0) {</span>
<span class="nc bnc" id="L1411" title="All 2 branches missed.">					for (int i = 0; i &lt; temp.length(); i++) {</span>
<span class="nc" id="L1412">						source.getCardAtLocation(source.length() - i - 1).unhighlight();</span>
					}
				}

<span class="nc" id="L1416">				sourceList.removeLast();</span>
<span class="nc" id="L1417">				numCardsInDiscardView.removeLast();</span>
<span class="nc" id="L1418">				numCards.removeLast();</span>
<span class="nc" id="L1419">			}</span>

<span class="fc bfc" id="L1421" title="All 6 branches covered.">			else if (!hasSelected &amp;&amp; e.getClickCount() == 1 || (e.getSource() instanceof DealDeck)) {</span>
<span class="fc" id="L1422">				source = (CardStack) e.getSource();</span>

<span class="fc bfc" id="L1424" title="All 2 branches covered.">				if (source instanceof DealDeck) {</span>
<span class="fc bfc" id="L1425" title="All 2 branches covered.">					if (hasSelected) {</span>
<span class="fc" id="L1426">						hasSelected = false;</span>

<span class="pc bpc" id="L1428" title="1 of 2 branches missed.">						if (temp.length() &gt; 0) {</span>
<span class="fc bfc" id="L1429" title="All 2 branches covered.">							for (int i = 0; i &lt; temp.length(); i++) {</span>
<span class="fc" id="L1430">								sourceList.getLast().getCardAtLocation(sourceList.getLast().length() - i - 1)</span>
<span class="fc" id="L1431">										.unhighlight();</span>
							}
<span class="fc" id="L1433">						} else {</span>
<span class="nc" id="L1434">							sourceList.getLast().peek().unhighlight();</span>
						}

<span class="fc" id="L1437">						sourceList.getLast().repaint();</span>
<span class="fc" id="L1438">						repaint();</span>
<span class="fc" id="L1439">						sourceList.removeLast();</span>
<span class="fc" id="L1440">						numCardsInDiscardView.removeLast();</span>
<span class="fc" id="L1441">						numCards.removeLast();</span>
					}

<span class="fc" id="L1444">					numCardsInDiscardView.add(discardPile.getNumViewableCards());</span>
<span class="fc" id="L1445">					clickedCard = source.pop();</span>

<span class="fc bfc" id="L1447" title="All 2 branches covered.">					if (clickedCard != null) {</span>
<span class="fc" id="L1448">						sourceList.add(dealDeck);</span>
<span class="fc" id="L1449">						destinationList.add(discardPile);</span>
<span class="fc" id="L1450">						numCards.add(discardPile.getNumViewableCards());</span>
<span class="fc bfc" id="L1451" title="All 2 branches covered.">					} else if (dealDeck.hasDealsLeft())// The deck was reset but the player hasn't used up the times</span>
														// through the deck
					{
<span class="fc" id="L1454">						sourceList.add(dealDeck);</span>
<span class="fc" id="L1455">						destinationList.add(discardPile);</span>
<span class="fc" id="L1456">						numCards.add(0);</span>
<span class="fc" id="L1457">					} else {</span>
<span class="fc" id="L1458">						numCardsInDiscardView.removeLast();</span>
					}

<span class="fc" id="L1461">					return;</span>
				}

<span class="fc" id="L1464">				numCardsInDiscardView.add(discardPile.getNumViewableCards());</span>
<span class="fc" id="L1465">				clickedCard = source.getCardAtLocation(e.getPoint());</span>

<span class="fc bfc" id="L1467" title="All 2 branches covered.">				if (clickedCard != null) {</span>
<span class="fc" id="L1468">					hasSelected = true;</span>
<span class="fc" id="L1469">					temp = source.getStack(clickedCard);</span>

<span class="fc" id="L1471">					sourceList.add(source);</span>
<span class="fc" id="L1472">					numCards.add(temp.length());</span>

<span class="fc bfc" id="L1474" title="All 2 branches covered.">					if (temp.length() &gt; 1) {</span>
<span class="fc" id="L1475">						singleCardSelected = false;</span>
<span class="fc" id="L1476">					} else {</span>
<span class="fc" id="L1477">						singleCardSelected = true;</span>
					}
<span class="fc" id="L1479">				} else {</span>
<span class="fc" id="L1480">					numCardsInDiscardView.removeLast();</span>
<span class="fc" id="L1481">					hasSelected = false;</span>
<span class="fc" id="L1482">					return;</span>
				}
			}
			// Stack/card already selected
<span class="pc bpc" id="L1486" title="1 of 4 branches missed.">			else if (e.getClickCount() == 1 &amp;&amp; hasSelected) {</span>
<span class="fc" id="L1487">				destination = (CardStack) e.getSource();</span>

<span class="fc bfc" id="L1489" title="All 2 branches covered.">				if (singleCardSelected) {</span>
<span class="fc bfc" id="L1490" title="All 2 branches covered.">					if (destination.isValidMove(clickedCard)) {</span>
<span class="fc" id="L1491">						Card card = source.pop();</span>
<span class="fc" id="L1492">						card.unhighlight();</span>
<span class="fc" id="L1493">						destination.push(card);</span>

						// If move is valid, add destination info for undo
<span class="fc" id="L1496">						destinationList.add(destination);</span>

<span class="pc bpc" id="L1498" title="1 of 4 branches missed.">						if (destination instanceof AcePile &amp;&amp; clickedCard.getNumber() == Card.KING) {</span>
<span class="nc" id="L1499">							repaint();</span>
<span class="nc" id="L1500">							checkWin();</span>
						}
<span class="nc" id="L1502">					} else {</span>
						// Not needed with highlighting version
						// source.addCard(clickedCard);
<span class="fc" id="L1505">						source.peek().unhighlight();</span>

						// Upon invalid move, remove undo information for cards
<span class="fc" id="L1508">						sourceList.removeLast();</span>
<span class="fc" id="L1509">						numCards.removeLast();</span>
<span class="fc" id="L1510">						numCardsInDiscardView.removeLast();</span>
					}
<span class="fc" id="L1512">				} else {</span>
<span class="fc bfc" id="L1513" title="All 2 branches covered.">					if (destination.isValidMove(temp)) {</span>
<span class="fc" id="L1514">						CardStack stack = new CardStack();</span>

<span class="fc bfc" id="L1516" title="All 2 branches covered.">						for (int i = temp.length(); i &gt; 0; i--) {</span>
<span class="fc" id="L1517">							Card card = source.pop();</span>
<span class="fc" id="L1518">							card.unhighlight();</span>

<span class="fc" id="L1520">							stack.push(card);</span>
						}

<span class="fc" id="L1523">						destination.push(stack);</span>

						// If move is valid, add destination info for undo
<span class="fc" id="L1526">						destinationList.add(destination);</span>
<span class="fc" id="L1527">					} else {</span>
<span class="fc bfc" id="L1528" title="All 2 branches covered.">						for (int i = temp.length() - 1; i &gt;= 0; i--) {</span>
<span class="fc" id="L1529">							source.getCardAtLocation(source.length() - i - 1).unhighlight();</span>
						}

						// Upon invalid move, remove undo information for cards
<span class="fc" id="L1533">						sourceList.removeLast();</span>
<span class="fc" id="L1534">						numCards.removeLast();</span>
<span class="fc" id="L1535">						numCardsInDiscardView.removeLast();</span>
					}
				}

<span class="fc" id="L1539">				singleCardSelected = false;</span>
<span class="fc" id="L1540">				hasSelected = false;</span>
<span class="fc" id="L1541">				temp = null;</span>
<span class="fc" id="L1542">				clickedCard = null;</span>
			}

<span class="fc" id="L1545">			repaint();</span>
<span class="fc" id="L1546">		}</span>
	}

<span class="fc" id="L1549">	private class TimerListener implements ActionListener {</span>
		public void actionPerformed(ActionEvent e) {
<span class="pc bpc" id="L1551" title="1 of 2 branches missed.">			if (e.getSource() == timer) {</span>
<span class="fc" id="L1552">				timerCount++;</span>
<span class="fc" id="L1553">				timerLabel.setText(&quot;Time: &quot; + timerCount);</span>
<span class="fc" id="L1554">				statusBar.repaint();</span>
			}
<span class="fc" id="L1556">		}</span>
	}

<span class="fc" id="L1559">	public class MyWindowListener extends WindowAdapter {</span>
		public void windowClosing(WindowEvent e) {
<span class="fc" id="L1561">			int save = JOptionPane.showConfirmDialog(SolitaireBoard.this,</span>
<span class="fc" id="L1562">					&quot;Closing without saving will result &quot; + &quot;in a loss, would you like to save the current game?&quot;,</span>
<span class="fc" id="L1563">					&quot;Save Game?&quot;, JOptionPane.YES_NO_OPTION);</span>

<span class="pc bpc" id="L1565" title="1 of 2 branches missed.">			if (save == JOptionPane.YES_OPTION) {</span>
<span class="fc" id="L1566">				recordGame(SolitaireBoard.GAME_SAVED);</span>
<span class="nc" id="L1567">				System.exit(0);</span>
<span class="nc" id="L1568">			} else // if(save == JOptionPane.NO_OPTION)</span>
			{
<span class="nc" id="L1570">				recordGame(SolitaireBoard.GAME_LOST);</span>
<span class="nc" id="L1571">				System.exit(0);</span>
			}
<span class="nc" id="L1573">		}</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span>Merged (Dec 3, 2017 1:29:15 AM)</div></body></html>